"""
Unit tests for {{plugin_name}} plugin
"""

import pytest
from unittest.mock import Mock, AsyncMock, MagicMock
from ..plugin import {{plugin_class}}


@pytest.fixture
def mock_plugin_manager():
    """Create a mock plugin manager"""
    manager = Mock()
    manager.get_interface = Mock(return_value=Mock())
    manager.message_router = Mock()
    manager.database = Mock()
    return manager


@pytest.fixture
def plugin(mock_plugin_manager):
    """Create a plugin instance for testing"""
    config = {
        "enabled": True,
        {{#if has_scheduled_tasks}}
        "task_interval": 60,
        {{/if}}
    }
    return {{plugin_class}}("{{plugin_name}}", config, mock_plugin_manager)


@pytest.mark.asyncio
async def test_plugin_initialization(plugin):
    """Test plugin initialization"""
    result = await plugin.initialize()
    assert result is True


@pytest.mark.asyncio
async def test_plugin_disabled(mock_plugin_manager):
    """Test plugin with disabled configuration"""
    config = {"enabled": False}
    plugin = {{plugin_class}}("{{plugin_name}}", config, mock_plugin_manager)
    
    result = await plugin.initialize()
    assert result is False


{{#if has_commands}}
@pytest.mark.asyncio
async def test_example_command(plugin):
    """Test example command handler"""
    await plugin.initialize()
    
    args = ["test", "args"]
    context = {
        "sender_id": "test_user",
        "channel": "test_channel"
    }
    
    response = await plugin.handle_example_command(args, context)
    assert response is not None
    assert "test_user" in response or "Hello" in response
{{/if}}


def test_plugin_metadata(plugin):
    """Test plugin metadata"""
    metadata = plugin.get_metadata()
    
    assert metadata.name == "{{plugin_name}}"
    assert metadata.version == "{{plugin_version}}"
    assert metadata.description == "{{plugin_description}}"
    assert metadata.author == "{{plugin_author}}"


@pytest.mark.asyncio
async def test_plugin_shutdown(plugin):
    """Test plugin shutdown"""
    await plugin.initialize()
    await plugin.shutdown()
    # Verify cleanup was performed


{{#if has_scheduled_tasks}}
@pytest.mark.asyncio
async def test_periodic_task(plugin):
    """Test periodic task handler"""
    await plugin.initialize()
    
    # Execute the periodic task
    await plugin.periodic_task_handler()
    
    # Verify task executed successfully
    # Add specific assertions based on your task logic
{{/if}}


{{#if has_menu_items}}
@pytest.mark.asyncio
async def test_menu_handler(plugin):
    """Test BBS menu handler"""
    await plugin.initialize()
    
    context = {
        "user_name": "TestUser",
        "user_id": "test123"
    }
    
    response = await plugin.menu_handler(context)
    assert response is not None
    assert "TestUser" in response or "{{plugin_name}}" in response
{{/if}}
